<% include header %>

<script type="text/javascript" src="/javascripts/jquery.min.js"></script>
<link href="/ueditor/themes/default/css/umeditor.css" type="text/css" rel="stylesheet">
<script type="text/javascript" charset="utf-8" src="/ueditor/umeditor.config.js"></script>
<script type="text/javascript" charset="utf-8" src="/ueditor/umeditor.min.js"></script>
<script type="text/javascript" src="/ueditor/lang/zh-cn/zh-cn.js"></script>

<article class="box post post-excerpt">
<p>Title   <input type="text" name="title" value=""> </p>
<p>Tags 
<% tags.forEach(function(tag, index) { %>
    <input class="article_tags" type="checkbox" name="tags[]" value="<%= tag %>" id="tag_<%= index %>" /><label for="tag_<%= index %>"><%= tag %></label>
<% }) %>
</p>
<script type="text/plain" id="myEditor" style="width:1000px;height:240px;">
    Contents
</script>
<button class="btn" onclick="sendData()">submit</button>

<div class="info">
    <span class="date"><span class="month"><% var d = new Date(); %><%= (d.getMonth() + 1) %><span>y</span></span> <span class="day"><%= d.getDate() %></span><span class="year">, <%= d.getFullYear() %></span></span>
</div>
</article>
<script type="text/javascript">
var um = UM.getEditor('myEditor');
function sendData() {
    var article_tags = [];
    $('.article_tags:checked').each(function(index, tag){
        article_tags.push($(tag).val());
    });
    if(article_tags.length == 0) article_tags = null;
    $.post('/post', {
            title : $('[name=title]').val(),
            post : UM.getEditor('myEditor').getContent(),
            tags : article_tags
        }, function(ret){
        if(!ret)
        {
            alert('post error');
            return;
        }

        if(ret.code == 1)
        {
            location.href = '/';
            return;
        }
        else {
            alert(ret.message);
        }
    });
}

</script>

<% include footer %>